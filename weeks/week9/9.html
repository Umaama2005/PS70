<!DOCTYPE html>
<html lang="en">
<head>
  <title>umaama hussain's ps70 documentation</title>
  <link rel="preconnect" href="https://fonts.googleapis.com"> 
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin> 
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/arduino-light.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/arduino.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body bgcolor=#000000>
  <div>
    <pre>
      <nav class="navbar navbar-expand-sm navbar-light bg-light">
        <div style="align-items: left; justify-content:left;" class="container-fluid">
          <h3 class="nav-title"> week 9 </h3>
          <div class="navbar-nav">
            <h4></h4>
            <h4><a href="https://umaama2005.github.io/PS70/index.html">back to home</a></h4>
            <h4><a href="https://umaama2005.github.io/PS70/about.html">back to about</a></h4>
          </div>
        </div>
      </nav>
    </pre>
  </div>

  <div>
    <pre style="color:gray">
# electronic output devices
    </pre>
    <pre style="color:gray">
# ---------------------------------
    </pre>
    <pre>
      back in week 7, we made a circuit with various output devices and wrote code to do something with them. i chose the oled screen and found code that shows falling stars across the screen.
    </pre>
    <p>
      <img src="iot.gif" width="500">
    </p>
  </div>

  <div>
    <pre style="color:gray">
# internet of things
    </pre>
    <pre style="color:gray">
# ---------------------------------
    </pre>
    <pre>
    	for this assignment, i began working with said, who unfortunately dropped the class - so it was just me. but it was alright because i was planning on using some iot features on my final project! the main thing i wanted to do was to be able to send the data from my sensor readings to a database that i could access from anywhere in the world, at any time. i used <a href="https://randomnerdtutorials.com/esp32-how-to-log-data/"> this article from randomnerdtutorials </a> to help me figure out what method of datalogging would suit my project best. i decided that influxdb would be most suitable because it has an option to visualise your data on the platform itself, and it seemed pretty simple to set up. there was also this really helpful tutorial on <a href="https://randomnerdtutorials.com/esp32-esp8266-sensor-bme280-influxdb/"> sending BME208 sensor readings to influxdb </a>. i simply edited the code that was meant for the BME208 to the code needed for DHT-22 sensors. here is a snippet of the edited version - i used chatgpt to help me integrate the edited code from the tutorial with my main code for my circuits.
    </pre>
    <pre><code class="language-arduino">
      sensorReadings.addField("T1", t1);
      sensorReadings.addField("T2", t2);
      sensorReadings.addField("T3", t3);
      sensorReadings.addField("T4", t4);
      sensorReadings.addField("T5", t5);
      sensorReadings.addField("T6", t6);
      sensorReadings.addField("H1", h1);
      sensorReadings.addField("H2", h2);
      sensorReadings.addField("H3", h3);
      sensorReadings.addField("H4", h4);
      sensorReadings.addField("H5", h5);
      sensorReadings.addField("H6", h6);

      // Print what are we exactly writing
      Serial.print("Writing: ");
      Serial.println(client.pointToLineProtocol(sensorReadings));

      // Write point into buffer
      client.writePoint(sensorReadings);

      // Clear fields for next usage. Tags remain the same.
      sensorReadings.clearFields();

      // If no Wifi signal, try to reconnect it
      if (wifiMulti.run() != WL_CONNECTED) {
        Serial.println("Wifi connection lost");
      }
    </code></pre>
    <pre>
      another thing that i wanted to do was also change the relay interval for the exchanger fans using a websocket, as this is one of the main parameters of the model. i found these two really helpful tutorials on randomnerd, one on <a href="https://randomnerdtutorials.com/esp32-esp8266-thermostat-web-server/">creating a thermostat webserver, </a> and another on <a href="https://randomnerdtutorials.com/esp32-async-web-server-espasyncwebserver-library/">controlling outputs.</a> i combined the structure and layout of the first one with the logic of the second one, so that users could input a value for the new interval for the relays, and submit it, and instantly change the intervals at which the fans switch. again, i used chatgpt to help me integrate the code with my main code, and here is the html used and edited
    </pre>
    <pre><code class="language-arduino">
      // HTML page for user to set interval
      const char index_html[] PROGMEM = R"rawliteral(
      <!DOCTYPE HTML><html>
      <head>
        <title>Relay Interval Controller</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">

      <style>
      body { font-family: Arial; text-align:center; }
      input { font-size: 22px; padding: 8px; width: 200px; }
      button { padding: 12px 30px; font-size: 22px; }
      </style>
      </head>

      <body>
      <h2>Set Relay Toggle Interval (ms)</h2>

      <p>Current interval: <span id="current">%INTERVAL%</span> ms</p>

      <input id="newInterval" type="number" min="100" placeholder="4000">
      <button onclick="sendInterval()">Set Interval</button>

      <script>
      var gateway = `ws://${window.location.hostname}/ws`;
      var websocket;

      window.addEventListener('load', initWebSocket);

      function initWebSocket() {
        websocket = new WebSocket(gateway);
        websocket.onmessage = onMessage;
      }

      function sendInterval() {
        let val = document.getElementById('newInterval').value;
        websocket.send("interval:" + val);
      }

      function onMessage(event) {
        document.getElementById("current").innerHTML = event.data;
      }
      </script>

      </body>
      </html>
      )rawliteral";
    </code></pre>
  </div>

</body>
<link rel="stylesheet" href="https://umaama2005.github.io/PS70/style.css">

</html>
