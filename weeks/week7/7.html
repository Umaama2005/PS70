<!DOCTYPE html>
<html lang="en">

<head>
  <title>umaama hussain</title>
  <link rel="preconnect" href="https://fonts.googleapis.com"> 
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin> 
<link href="https://fonts.googleapis.com/css2?family=Roboto+Mono&display=swap" rel="stylesheet">
</head>

<body bgcolor=#000000>
      <div>
    <pre>
<a href="https://umaama2005.github.io/PS70/">back to home</a> 
    </pre>
  </div>

  <div>
    <pre style="color:gray">
/week 7
    </pre>
  </div>
 

  <div>
    <pre style="color:gray">
      # the kangaroo rat
    </pre>
    <pre style="color:gray">
      # ---------------------------------
    </pre>
    <p>
      <img src="kangaroo_rat_1.jpg" width="500">
    </p>
    <p>
      <img src="kangaroo_rat_2.jpg" width="500">
    </p>
    <p>
      this is the kangaroo rat! it is an exceptionally cute little animal, but it is also really fascinating in its ability to be energy efficient and preserve the water and heat in its body, despite living in an extreme climate. the kangaroo rat's nasal passages function as a counter-current heat exchanger. when the rodent exhales, the walls of the nasal passage absorbs and stores the heat and moisture from the exhaled air. then, when the rodent inhales, the air reabsorbs the heat and moisture from the walls of the nasal passages. this reduces the need to warm and humidify inhaled air using metabolic heat, allowing the kangaroo rat to recover a whopping 83% of water, and preserve 88% of heat lost due to breathing.
    </p>
  </div>

  <div>
    <pre style="color:gray">
      # the nosehouse
    </pre>
    <pre style="color:gray">
      # ---------------------------------
    </pre>
    <p>
      "nosehouse: heat-conserving ventilators based on nasal counterflow exchangers" by steven vogel builds upon the biological principle of the kangaroo rat's nasal passageways. vogel constructed this "nosehouse" where he replicates the upper respiratory tract of a kangaroo rat to ventilate and thermoregulate an enclosed space, such as a modern building, in an energy efficient manner. this is the model that i am attempting to replicate and build upon.
    </p>
  </div>

  <div>
    <pre style="color:gray">
      # the schematics
    </pre>
    <pre style="color:gray">
      # ---------------------------------
    </pre>
    <p>
      vogel's diagram of model and exchanger
      <img src="vogel_diagram.png" width="500">
    </p>
  </div>

  <div>
    <pre style="color:gray">
      # the circuitry
    </pre>
    <pre style="color:gray">
      # ---------------------------------
    </pre>
    <p>
      the sensor circuit - this was how all 6 sensors were connected (just each to different data pins)
    </p>
    <p>
      <img src="sensor_circuit.png" width="500">
    </p>
    <p>
      the load circuit - this was how all the fans and the heater were connected (also each to different data pins)
    </p>
    <p>
      <img src="fan_circuit.png" width="500">
    </p>
  </div>

  <div>
    <pre style="color:gray">
      # the code
    </pre>
    <pre style="color:gray">
      # ---------------------------------
    </pre>
    <p>
      i wrote 3 different codes to run on my model. all the code is at the bottom of this page. 
    </p>
    <p>
      the first one was a test code, which i ran a lot in the beginning to test if all my sensors and relays were functioning. the code simply collected data from all 6 sensors, and printed them. if the data was not being collected, it printed an error message. then, using the delay function, i then would switch all the relays on and off. this test code was used for a lot of trial and error (a lot). since there was a lot of wiring going on, this helped me narrow down what component and what wires were the problem. 
    </p>
    <p>
      the second code was just gathering the temperature data from the model for the control case. here, i just needed the one relay controlling the aerial fan to always be on (to ensure uniform temperature inside the chamber). i also continued collecting the data from all 6 sensors. i learned the hard way that you cannot copy data off of the serial monitor. so, i added a data streamer add in to excel, that allowed me to collect and record the data and save it directly onto a csv file. 
    </p>
    <p>
      the third code was the one that involved the exchangers. for this one, i needed to incorporate the c++ class structure to write a non-blocking code so that i could run the relay and sensor functions simultaneously. the aerial fan continued to stay switched on. the sensors also continued gathering data (and transferring it to excel and a csv file). now, the two relays controlling the exchanger fans would also switch on an off alternatively every 100 seconds. 
    </p>

  <div>
    <pre style="color:gray">
      # the product
    </pre>
    <pre style="color:gray">
      # ---------------------------------
    </pre>
    <p>
      set up
      <img src="chamber_aerial.jpeg" width="500">
      <img src="aerial.jpeg" width="500">
      <img src="chamber_side.jpeg" width="500">
      <img src="chamber_side1.jpeg" width="500">
    </p>
    <p>
      exchanger
      <img src="exchanger.jpeg" width="500">
      <img src="in_exchanger.jpeg" width="500">
    </p>
    <p>
      aerial fan
      <img src="aerial_fan.jpeg" width="500">
    </p>
    <p>
      heater
      <img src="heater.jpeg" width="500">
    </p>
    <p>
      sensor
      <img src="sensor.jpeg" width="500">
    </p>
    <p>
      exchanger fan
      <img src="fan.jpeg" width="500">
    </p>
    <p>
      <video width="320" height="240" controls>
        <source src="fan_vid.mp4" type="video/mp4">
      </video>
    </p>
  </div>

  <div>
    <pre style="color:gray">
      # the mess
    </pre>
    <pre style="color:gray">
      # ---------------------------------
    </pre>
    <p>
      i still have a bit to do to improve my project. while the wiring and circuit finally work (yay!) it is kind of a mess. 
    </p>
    <p>
      <img src="mess1.jpeg" width="500">
      <img src="mess2.jpeg" width="500">
      <img src="mess3.jpeg" width="500">
    </p>
  </div>

  <div>
    <pre style="color:gray">
      # future steps
    </pre>
    <pre style="color:gray">
      # ---------------------------------
    </pre>
    <p>
      by tuesday: rewire circuit so it looks a lot cleaner, redo some of the mechanics to make things look cleaner, add sd card and data logger so data can be collected when i am not sitting at the model with my laptop for hours, solder the wire connections.
    </p>
    <p>
      by finals week: add more sensors along exchanger and inside chamber, build an environmental chamber with temperature control, develop more complex exchanger designs.
    </p>
  </div>

  <div>
    <pre style="color:gray">
      # the code contd.
    </pre>
    <pre style="color:gray">
      # ---------------------------------
    </pre>
    <p>
      code 1 (left some comments in to show the process):
    </p>
    <code style="color:gray">
      #include "DHT.h"

      // Relay pins
      int relayPin1 = 2; //aerial fan (red)
      int relayPin2 = 11; //left fan (blue)
      int relayPin3 = 9; //right fan (white)
      int relayPin4 = 10; //heater (orange)

      // DHT pins
      #define DHTPIN1 3 //back (brown)
      #define DHTPIN2 4 //left in (yellow)
      #define DHTPIN3 5 //left out (green) FAILED
      #define DHTPIN4 8 //right in (purple) 
      #define DHTPIN5 12 //right out (gray)
      #define DHTPIN6 13 //Move to 8 maybe, front (gray)

      #define DHTTYPE DHT22

      DHT dht1(DHTPIN1, DHTTYPE);
      DHT dht2(DHTPIN2, DHTTYPE);
      DHT dht3(DHTPIN3, DHTTYPE);
      DHT dht4(DHTPIN4, DHTTYPE);
      DHT dht5(DHTPIN5, DHTTYPE);
      DHT dht6(DHTPIN6, DHTTYPE);

      void setup() {
        // Relay set up
        pinMode(relayPin1, OUTPUT);
        pinMode(relayPin2, OUTPUT);
        pinMode(relayPin3, OUTPUT);
        pinMode(relayPin4, OUTPUT);

        // Start with relays off
        digitalWrite(relayPin1, HIGH);
        digitalWrite(relayPin2, HIGH);
        digitalWrite(relayPin3, HIGH); 
        digitalWrite(relayPin4, HIGH); 

        Serial.begin(9600);

        // Initialize sensors
        dht1.begin();
        dht2.begin();
        dht3.begin();
        dht4.begin();
        dht5.begin();
        dht6.begin();
      }

      void loop() {
        // Relay control

        Serial.println("Turning all relays ON");
        digitalWrite(relayPin1, LOW);                 
        digitalWrite(relayPin2, LOW); 
        digitalWrite(relayPin3, LOW); 
        digitalWrite(relayPin4, LOW); 
        delay(4000);  

        Serial.println("Turning all relays OFF");
        digitalWrite(relayPin1, HIGH);                  
        digitalWrite(relayPin2, HIGH); 
        digitalWrite(relayPin3, HIGH); 
        digitalWrite(relayPin4, HIGH); 
        delay(4000);

        // Sensor readings
        printSensorData("Sensor1", dht1);
        printSensorData("Sensor2", dht2);
        printSensorData("Sensor3", dht3);
        printSensorData("Sensor4", dht4);
        printSensorData("Sensor5", dht5);
        printSensorData("Sensor6", dht6);

        delay(2000);
      }

      void printSensorData(const char* label, DHT &sensor) {
        float h = sensor.readHumidity();
        float t = sensor.readTemperature();

        if (isnan(h) || isnan(t)) {
          Serial.print(label);
          Serial.println(": Failed to read");
        } else {
          Serial.print(label);
          Serial.print(": ");
          Serial.print(t);
          Serial.print(" Â°C, ");
          Serial.print(h);
          Serial.println(" %");
        }
      }
    </code>
    <p>
      code 2:
    </p>
    <code style="color:gray">
      #include "DHT.h"

      // Relay pins
      int relayPin1 = 2; //aerial fan 

      // DHT pins
      #define DHTPIN1 3 //back 
      #define DHTPIN2 13 //front 
      #define DHTPIN3 4 //left in 
      #define DHTPIN4 8 //right in 
      #define DHTPIN5 5 //left out  
      #define DHTPIN6 12 //right out 

      #define DHTTYPE DHT22

      DHT dht1(DHTPIN1, DHTTYPE);
      DHT dht2(DHTPIN2, DHTTYPE);
      DHT dht3(DHTPIN3, DHTTYPE);
      DHT dht4(DHTPIN4, DHTTYPE);
      DHT dht5(DHTPIN5, DHTTYPE);
      DHT dht6(DHTPIN6, DHTTYPE);

      void setup() {
        // Relay set up
        pinMode(relayPin1, OUTPUT);

        // Start with aerial fan on
        digitalWrite(relayPin1, HIGH);

        Serial.begin(9600);

        // Initialize sensors
        dht1.begin();
        dht2.begin();
        dht3.begin();
        dht4.begin();
        dht5.begin();
        dht6.begin();
      }

      void loop() {
        // Sensor readings
        float h1 = dht1.readHumidity();
        float t1 = dht1.readTemperature();

        float h2 = dht2.readHumidity();
        float t2 = dht2.readTemperature();

        float h3 = dht3.readHumidity();
        float t3 = dht3.readTemperature();

        float h4 = dht4.readHumidity();
        float t4 = dht4.readTemperature();

        float h5 = dht5.readHumidity();
        float t5 = dht5.readTemperature();

        float h6 = dht6.readHumidity();
        float t6 = dht6.readTemperature();

        // Printing so that all data collected at same time is on same line and comma separated
        Serial.print(t1); Serial.print(","); Serial.print(h1); Serial.print(",");
        Serial.print(t2); Serial.print(","); Serial.print(h2); Serial.print(",");
        Serial.print(t3); Serial.print(","); Serial.print(h3); Serial.print(",");
        Serial.print(t4); Serial.print(","); Serial.print(h4); Serial.print(",");
        Serial.print(t5); Serial.print(","); Serial.print(h5); Serial.print(",");
        Serial.print(t6); Serial.print(","); Serial.println(h6);

        delay(100000);
      }
    </code>
    <p>
      code 3:
    </p>
    <code style="color:gray">
      #include "DHT.h"

      // Relay pins
      int relayPin1 = 2; //aerial fan 
      int relayPin2 = 11; //left fan
      int relayPin3 = 9; //right fan 

      // DHT pins
      #define DHTPIN1 3 //back 
      #define DHTPIN2 13 //front 
      #define DHTPIN3 4 //left in 
      #define DHTPIN4 8 //right in 
      #define DHTPIN5 5 //left out  
      #define DHTPIN6 12 //right out 

      #define DHTTYPE DHT22

      DHT dht1(DHTPIN1, DHTTYPE);
      DHT dht2(DHTPIN2, DHTTYPE);
      DHT dht3(DHTPIN3, DHTTYPE);
      DHT dht4(DHTPIN4, DHTTYPE);
      DHT dht5(DHTPIN5, DHTTYPE);
      DHT dht6(DHTPIN6, DHTTYPE);

      // Timing variables
      unsigned long lastRelayToggle = 0;
      unsigned long relayInterval = 10000; // toggle relays every 100s

      unsigned long lastSensorRead = 0;
      unsigned long sensorInterval = 10000; // read sensors every 10s

      bool relaysOn = false;


      void setup() {
        // Relay set up
        pinMode(relayPin1, OUTPUT);
        pinMode(relayPin2, OUTPUT);
        pinMode(relayPin3, OUTPUT);

       // Aerial fan always on
        digitalWrite(relayPin1, HIGH);

        // Start with left fan off
        digitalWrite(relayPin2, LOW);

        // Start with right fan on
        digitalWrite(relayPin3, HIGH); 

        Serial.begin(9600);

        // Initialize sensors
        dht1.begin();
        dht2.begin();
        dht3.begin();
        dht4.begin();
        dht5.begin();
        dht6.begin();
      }

      void loop() {
        unsigned long now = millis();

        // Relay control 
        if (now - lastRelayToggle >= relayInterval) {
          lastRelayToggle = now;
          relaysOn = !relaysOn; // flip state

          if (relaysOn) {
            digitalWrite(relayPin2, HIGH);
            digitalWrite(relayPin3, LOW);
          } else {
            digitalWrite(relayPin2, LOW);
            digitalWrite(relayPin3, HIGH);
          }
        }

        // Sensor readings
        if (now - lastSensorRead >= sensorInterval) {
          lastSensorRead = now;
          float h1 = dht1.readHumidity();
          float t1 = dht1.readTemperature();

          float h2 = dht2.readHumidity();
          float t2 = dht2.readTemperature();

          float h3 = dht3.readHumidity();
          float t3 = dht3.readTemperature();

          float h4 = dht4.readHumidity();
          float t4 = dht4.readTemperature();

          float h5 = dht5.readHumidity();
          float t5 = dht5.readTemperature();

          float h6 = dht6.readHumidity();
          float t6 = dht6.readTemperature();

          Serial.print(t1); Serial.print(","); Serial.print(h1); Serial.print(",");
          Serial.print(t2); Serial.print(","); Serial.print(h2); Serial.print(",");
          Serial.print(t3); Serial.print(","); Serial.print(h3); Serial.print(",");
          Serial.print(t4); Serial.print(","); Serial.print(h4); Serial.print(",");
          Serial.print(t5); Serial.print(","); Serial.print(h5); Serial.print(",");
          Serial.print(t6); Serial.print(","); Serial.println(h6);
        }
      }
    </code>
  </div>

</body>

<link rel="stylesheet" href="https://umaama2005.github.io/PS70/style.css">

</html>
